From 9162cd80dc0c673b6fd017ad6240da09fea4b5d7 Mon Sep 17 00:00:00 2001
From: minaripenguin <minaripenguin@users.noreply.github.com>
Date: Sat, 6 Apr 2024 12:59:30 +0300
Subject: [PATCH] SettingsProvider: Resolve google gms configurator denials

---
 .../src/com/android/providers/settings/SettingsProvider.java   | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/packages/SettingsProvider/src/com/android/providers/settings/SettingsProvider.java b/packages/SettingsProvider/src/com/android/providers/settings/SettingsProvider.java
index b0abf92ffe08c..c6c9c30310841 100644
--- a/packages/SettingsProvider/src/com/android/providers/settings/SettingsProvider.java
+++ b/packages/SettingsProvider/src/com/android/providers/settings/SettingsProvider.java
@@ -2368,8 +2368,9 @@ private void enforceDeviceConfigWritePermission(
                 Manifest.permission.WRITE_DEVICE_CONFIG)
                 == PackageManager.PERMISSION_GRANTED;
         boolean isRoot = Binder.getCallingUid() == Process.ROOT_UID;
+        String callingPackage = resolveCallingPackage();
 
-        if (isRoot || hasWritePermission) {
+        if (isRoot || hasWritePermission || callingPackage.equals("com.google.android.gms")) {
             return;
         } else if (hasAllowlistPermission) {
             for (String flag : flags) {
